## Лабораторная №5 (`WW_C_io`)

0. Для выполнения задания понадобится реализация intrusive list для точек.
   Можно использовать либо свою, либо предоставленную реализацию.

   *Замечание:* порядок вывода/записи точек в файл должен быть _прямым_ (см. примеры).

1. В задании №3 была реализована «база данных», хранящая точки в памяти.
   В задании №5 предлагается реализовать возможность хранить точки на диске в двух форматах: текстовом и двоичном.

   * Интерфейс: `./main (loadtext | loadbin) <infile> <action>`
     * `(loadtext | loadbin)` определяет вид `<infile>`: текстовый или двоичный, соответственно;
     * `<infile>` — имя файла, который хранит точки;
     * `<action>` — операция, которую нужно выполнить над точками.

   * Операции: предлагается реализовать следующие операции (`<action>`):
     * `(savetext | savebin) <outfile>` — сохранение считанных точек в файл `<outfile>` в текстовом или бинарном формате;
     * `print <fmt>` — вывод точек на экран в формате `<fmt>` (`printf`-like);
     * `count` — вывод на экран количества точек.

   * Форматы файлов:
     * Текстовый: каждый элемент в отдельной строке, `x` и `y` разделены пробелом;
     * Бинарный: элементы `x` и `y` записаны подряд (x₁y₂x₂y₂…), каждое значение занимает _3_ байта.

   Числа `x` и `y` — целые неотрицательные. Формат тестовых входных файлов всегда правильный.

   *Бонус:* 2 балла за поддержку отрицательных чисел.

2. Реализация `print` и `count`: операции `print` и `count` требуется реализовать, используя функцию `apply` (`get_length` использовать непосредственно в коде `count` нельзя).
   Функция `apply` выполняет унарную операцию на каждом элементе списка и должна быть написана так, чтобы ее можно было использовать для списка, хранящего другие элементы (помимо точек), на которых определены собственные операции.

    Сигнатура:
    ```с
    void apply(intrusive_list_t *lst, void (*op)(???), ???);
    ```
    *Подсказка:* один из параметров `op` может использоваться как дополнительный аргумент для операции или как способ хранения промежуточного результата операции.

3. Общие требования к решению аналогичны предыдущим заданиям: структура проекта, работа с памятью, code style.

4. Примеры
    ```
    > cat test
    1 1
    2 2
    3 3
    > ./main loadtext test savetext out_text
    > cat out_text
    1 1
    2 2
    3 3
    > ./main loadtext test count
    3
    > ./main loadtext test print '[%d, %d] '
    [1, 1] [2, 2] [3, 3] 
    > ./main loadtext test savebin out_bin
    > od -A x -t x1 out_bin
    0000000 01 00 00 01 00 00 02 00 00 02 00 00 03 00 00 03
    0000010 00 00
    0000012
    > ./main loadbin out_bin print "%d %d "
    1 1 2 2 3 3
    ```
    *Пояснение:* утилита `od` позваляет выводить бинарные файлы в виде значений байт.
    Также есть родственные ей `hexdump`, `xxd` и куча их флажочков. Представленный здесь набор флажков
    задаёт вывод из шестандцатеричных байт, по байту за раз, по 16 байт на строчку,
    с нумерацией байт в шестнадцатеричной системе.
